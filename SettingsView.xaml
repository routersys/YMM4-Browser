<UserControl x:Class="YMM4Browser.View.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="settingsView">

    <UserControl.Resources>
        <LinearGradientBrush x:Key="UpdateBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#FF2E8B57" Offset="0.0" />
            <GradientStop Color="#FF2A7A4E" Offset="1.0" />
        </LinearGradientBrush>

        <Style TargetType="GroupBox">
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
            <Setter Property="Padding" Value="10"/>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
        </Style>
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
        </Style>

        <Style x:Key="DraggableListViewItem" TargetType="ListViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="AllowDrop" Value="True" />
            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="ListViewItem_PreviewMouseLeftButtonDown"/>
            <EventSetter Event="PreviewMouseMove" Handler="ListViewItem_PreviewMouseMove"/>
            <EventSetter Event="Drop" Handler="ListViewItem_Drop"/>
            <EventSetter Event="DragEnter" Handler="ListViewItem_DragEnter"/>
            <EventSetter Event="DragLeave" Handler="ListViewItem_DragLeave"/>
            <EventSetter Event="MouseRightButtonUp" Handler="BookmarkListViewItem_MouseRightButtonUp"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlLightBrushKey}}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}">
        <StackPanel Margin="10">

            <StackPanel Orientation="Horizontal" Margin="2,2,2,10">
                <Border BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                        BorderThickness="1" CornerRadius="3"
                        Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
                        Padding="8,4" Margin="0,0,5,0">
                    <TextBlock Text="{Binding CurrentVersionText}"
                               VerticalAlignment="Center"
                               Foreground="{DynamicResource {x:Static SystemColors.ControlLightLightBrushKey}}"/>
                </Border>

                <Border BorderThickness="1" CornerRadius="3"
                        Padding="8,4">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
                            <Setter Property="Visibility" Value="Visible"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsUpdateAvailable}" Value="True">
                                    <Setter Property="Background" Value="{StaticResource UpdateBrush}"/>
                                    <Setter Property="BorderBrush" Value="#FF34C759"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding UpdateMessage}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding UpdateMessage}" Value="">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <StackPanel Orientation="Horizontal">
                        <Path Width="14" Height="14" Stretch="Uniform" VerticalAlignment="Center" Margin="0,0,8,0">
                            <Path.Style>
                                <Style TargetType="Path">
                                    <Setter Property="Fill" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                                    <Setter Property="Data" Value="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,17A1.5,1.5 0 0,0 13.5,15.5V11A1.5,1.5 0 0,0 12,9.5A1.5,1.5 0 0,0 10.5,11V15.5A1.5,1.5 0 0,0 12,17M12,5.5A1.5,1.5 0 0,0 10.5,7A1.5,1.5 0 0,0 12,8.5A1.5,1.5 0 0,0 13.5,7A1.5,1.5 0 0,0 12,5.5Z"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsUpdateAvailable}" Value="True">
                                            <Setter Property="Fill" Value="White"/>
                                            <Setter Property="Data" Value="M19,9H15V3H9V9H5L12,16L19,9M5,18V20H19V18H5Z"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Path.Style>
                        </Path>
                        <TextBlock Text="{Binding UpdateMessage}"
                                   VerticalAlignment="Center"
                                   TextWrapping="NoWrap">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsUpdateAvailable}" Value="True">
                                            <Setter Property="Foreground" Value="White"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </Border>
            </StackPanel>

            <GroupBox Header="基本設定" Margin="0,0,0,10">
                <StackPanel Margin="5">
                    <Label Content="ホームページURL"/>
                    <TextBox x:Name="HomeUrlTextBox"
                             Text="{Binding HomeUrl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,0,10"
                             Height="24"
                             VerticalContentAlignment="Center"/>

                    <CheckBox x:Name="CompactModeCheckBox"
                              IsChecked="{Binding CompactMode, Mode=TwoWay}"
                              Content="コンパクトモード"
                              Margin="0,0,0,5"/>

                    <Label Content="履歴保存件数"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBox Text="{Binding MaxHistoryItems, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Width="100"
                                 Height="24"
                                 VerticalContentAlignment="Center"/>
                        <Label Content="件" Margin="5,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="セキュリティ・機能設定" Margin="0,0,0,10">
                <StackPanel Margin="5">
                    <CheckBox x:Name="AdBlockCheckBox"
                              IsChecked="{Binding EnableAdBlock, Mode=TwoWay}"
                              Content="広告ブロックを有効にする"
                              Margin="0,0,0,5"/>
                    <CheckBox x:Name="PopupBlockCheckBox"
                              IsChecked="{Binding EnablePopupBlock, Mode=TwoWay}"
                              Content="ポップアップブロックを有効にする"
                              Margin="0,0,0,5"/>
                    <CheckBox x:Name="JavaScriptCheckBox"
                              IsChecked="{Binding EnableJavaScript, Mode=TwoWay}"
                              Content="JavaScriptを有効にする"
                              Margin="0,0,0,5"/>
                    <CheckBox x:Name="CookiesCheckBox"
                              IsChecked="{Binding EnableCookies, Mode=TwoWay}"
                              Content="Cookieを有効にする"
                              Margin="0,0,0,5"/>
                    <CheckBox x:Name="ExtensionsCheckBox"
                              IsChecked="{Binding EnableExtensions, Mode=TwoWay}"
                              Content="拡張機能サポートを有効にする（実験的機能）"
                              Margin="0,0,0,5"/>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="ブックマークグループ管理" Margin="0,0,0,10">
                <StackPanel Margin="5">
                    <Label Content="ブックマークグループ"/>
                    <Border Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                            BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                            BorderThickness="1"
                            Margin="0,0,0,10">
                        <ListView x:Name="BookmarkGroupListView"
                                  ItemsSource="{Binding BookmarkGroups}"
                                  Height="120"
                                  SelectionMode="Single"
                                  Background="Transparent"
                                  BorderThickness="0">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <EventSetter Event="MouseRightButtonUp" Handler="BookmarkGroupListViewItem_MouseRightButtonUp"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="グループ名" Width="200">
                                        <GridViewColumn.HeaderContainerStyle>
                                            <Style TargetType="GridViewColumnHeader">
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
                                                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                            </Style>
                                        </GridViewColumn.HeaderContainerStyle>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0"
                                                           Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="ブックマーク数" Width="120">
                                        <GridViewColumn.HeaderContainerStyle>
                                            <Style TargetType="GridViewColumnHeader">
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
                                                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                            </Style>
                                        </GridViewColumn.HeaderContainerStyle>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding BookmarkCount}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0"
                                                           HorizontalAlignment="Center"
                                                           Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Border>

                    <StackPanel Orientation="Horizontal">
                        <Button Content="グループ追加"
                                Width="100"
                                Height="28"
                                Margin="0,0,10,0"
                                Click="AddBookmarkGroupButton_Click"/>
                        <Button Content="グループ削除"
                                Width="100"
                                Height="28"
                                Click="RemoveBookmarkGroupButton_Click"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="ブックマーク管理">
                <StackPanel Margin="5">
                    <DockPanel Margin="0,0,0,10">
                        <Label DockPanel.Dock="Left" Content="登録済みブックマーク"/>
                        <ComboBox x:Name="GroupFilterComboBox"
                                  DockPanel.Dock="Right"
                                  Width="150"
                                  Height="24"
                                  VerticalContentAlignment="Center"
                                  DisplayMemberPath="Name"
                                  SelectionChanged="GroupFilterComboBox_SelectionChanged">
                        </ComboBox>
                        <Label DockPanel.Dock="Right" Content="グループフィルタ:" Margin="10,0,5,0"/>
                    </DockPanel>

                    <Border Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                            BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                            BorderThickness="1"
                            Margin="0,0,0,10">
                        <ListView x:Name="BookmarkListView"
                                  ItemsSource="{Binding FilteredBookmarks}"
                                  Height="250"
                                  SelectionMode="Extended"
                                  Background="Transparent"
                                  BorderThickness="0"
                                  AllowDrop="True"
                                  Drop="BookmarkListView_Drop"
                                  DragEnter="BookmarkListView_DragEnter">
                            <ListView.ItemContainerStyle>
                                <StaticResource ResourceKey="DraggableListViewItem"/>
                            </ListView.ItemContainerStyle>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="名前" Width="180">
                                        <GridViewColumn.HeaderContainerStyle>
                                            <Style TargetType="GridViewColumnHeader">
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
                                                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                            </Style>
                                        </GridViewColumn.HeaderContainerStyle>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0"
                                                           TextTrimming="CharacterEllipsis"
                                                           Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="URL" Width="280">
                                        <GridViewColumn.HeaderContainerStyle>
                                            <Style TargetType="GridViewColumnHeader">
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
                                                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                            </Style>
                                        </GridViewColumn.HeaderContainerStyle>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Url}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0"
                                                           TextTrimming="CharacterEllipsis"
                                                           Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="グループ" Width="120">
                                        <GridViewColumn.HeaderContainerStyle>
                                            <Style TargetType="GridViewColumnHeader">
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
                                                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                            </Style>
                                        </GridViewColumn.HeaderContainerStyle>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding GroupName}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0"
                                                           TextTrimming="CharacterEllipsis"
                                                           Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Border>

                    <StackPanel Orientation="Horizontal">
                        <Button Content="追加"
                                Width="70"
                                Height="28"
                                Margin="0,0,10,0"
                                Click="AddBookmarkButton_Click"/>
                        <Button Content="削除"
                                Width="70"
                                Height="28"
                                Margin="0,0,10,0"
                                Click="RemoveBookmarkButton_Click"/>
                        <Button Content="上に移動"
                                Width="80"
                                Height="28"
                                Margin="0,0,10,0"
                                Click="MoveBookmarkUpButton_Click"/>
                        <Button Content="下に移動"
                                Width="80"
                                Height="28"
                                Margin="0,0,10,0"
                                Click="MoveBookmarkDownButton_Click"/>
                        <TextBlock Text="※ドラッグアンドドロップで並び替え可能"
                                   VerticalAlignment="Center"
                                   Margin="15,0,0,0"
                                   FontSize="11"
                                   Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="履歴管理" Margin="0,10,0,0">
                <StackPanel Margin="5">
                    <DockPanel Margin="0,0,0,10">
                        <Label DockPanel.Dock="Left" Content="閲覧履歴"/>
                        <Button DockPanel.Dock="Right"
                                Content="履歴をクリア"
                                Width="100"
                                Height="24"
                                Click="ClearHistoryButton_Click"/>
                        <TextBlock DockPanel.Dock="Right"
                                   Text="{Binding History.Count, StringFormat='{}件数: {0}'}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"/>
                    </DockPanel>

                    <Border Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                            BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                            BorderThickness="1"
                            Margin="0,0,0,10">
                        <ListView ItemsSource="{Binding History}"
                                  Height="150"
                                  Background="Transparent"
                                  BorderThickness="0">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="タイトル" Width="200">
                                        <GridViewColumn.HeaderContainerStyle>
                                            <Style TargetType="GridViewColumnHeader">
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
                                                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                            </Style>
                                        </GridViewColumn.HeaderContainerStyle>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Title}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0"
                                                           TextTrimming="CharacterEllipsis"
                                                           Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="URL" Width="250">
                                        <GridViewColumn.HeaderContainerStyle>
                                            <Style TargetType="GridViewColumnHeader">
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
                                                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                            </Style>
                                        </GridViewColumn.HeaderContainerStyle>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Url}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0"
                                                           TextTrimming="CharacterEllipsis"
                                                           Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="訪問日時" Width="130">
                                        <GridViewColumn.HeaderContainerStyle>
                                            <Style TargetType="GridViewColumnHeader">
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
                                                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                            </Style>
                                        </GridViewColumn.HeaderContainerStyle>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding VisitTime, StringFormat='{}{0:yyyy/MM/dd HH:mm}'}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0"
                                                           Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Border>
                </StackPanel>
            </GroupBox>
        </StackPanel>
    </ScrollViewer>
</UserControl>